{% extends "base.html" %} {% block content %}
<div class="card">
  <div class="card-header">
    <h2 class="card-title"><i class="fas fa-receipt"></i> {{ title }}</h2>
  </div>

  <form method="POST" class="expense-form">
    {{ form.hidden_tag() }}

    <div class="form-grid">
      <!-- Amount Field -->
      <div class="form-group">
        {{ form.amount.label(class="form-label") }}
        <div class="amount-input">
          <span class="currency-symbol"
            >{{ current_user.currency_symbol }}</span
          >
          {{ form.amount(class="form-control" + (" is-invalid" if
          form.amount.errors else "")) }}
        </div>
        {% for error in form.amount.errors %}
        <div class="invalid-feedback">{{ error }}</div>
        {% endfor %}
      </div>

      <!-- Description Field -->
      <div class="form-group">
        {{ form.description.label(class="form-label") }} {{
        form.description(class="form-control" + (" is-invalid" if
        form.description.errors else "")) }} {% for error in
        form.description.errors %}
        <div class="invalid-feedback">{{ error }}</div>
        {% endfor %}
      </div>

      <!-- Category Field -->
      <div class="form-group">
        {{ form.category_id.label(class="form-label") }} {{
        form.category_id(class="form-control" + (" is-invalid" if
        form.category_id.errors else "")) }} {% for error in
        form.category_id.errors %}
        <div class="invalid-feedback">{{ error }}</div>
        {% endfor %}
      </div>

      <!-- Date Field -->
      <div class="form-group">
        {{ form.date.label(class="form-label") }} {{
        form.date(class="form-control" + (" is-invalid" if form.date.errors else
        ""), type="date") }} {% for error in form.date.errors %}
        <div class="invalid-feedback">{{ error }}</div>
        {% endfor %}
      </div>

      <!-- Payment Method Field -->
      <div class="form-group">
        {{ form.payment_method.label(class="form-label") }} {{
        form.payment_method(class="form-control" + (" is-invalid" if
        form.payment_method.errors else "")) }} {% for error in
        form.payment_method.errors %}
        <div class="invalid-feedback">{{ error }}</div>
        {% endfor %}
      </div>

      <!-- Recurring Fields -->
      <div class="form-group recurring-container">
        <div class="recurring-toggle">
          {{ form.is_recurring(class="recurring-checkbox") }} {{
          form.is_recurring.label(class="form-label") }}
        </div>

        <div class="recurring-frequency" id="recurringFrequency">
          {{ form.recurrence_frequency.label(class="form-label") }} {{
          form.recurrence_frequency(class="form-control" + (" is-invalid" if
          form.recurrence_frequency.errors else "")) }} {% for error in
          form.recurrence_frequency.errors %}
          <div class="invalid-feedback">{{ error }}</div>
          {% endfor %}
        </div>
      </div>

      <!-- Notes Field -->
      <div class="form-group full-width">
        {{ form.receipt_note.label(class="form-label") }} {{
        form.receipt_note(class="form-control" + (" is-invalid" if
        form.receipt_note.errors else ""), rows=4) }} {% for error in
        form.receipt_note.errors %}
        <div class="invalid-feedback">{{ error }}</div>
        {% endfor %}
      </div>
    </div>

    <div class="form-actions">
      {{ form.submit(class="btn btn-primary") }}
      <a href="{{ url_for('expenses.index') }}" class="btn btn-secondary">
        Cancel
      </a>
    </div>
  </form>
</div>
{% endblock %} {% block extra_css %}
<style>
  .expense-form {
    padding: 2rem;
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
  }

  .full-width {
    grid-column: 1 / -1;
  }

  .amount-input {
    position: relative;
  }

  .currency-symbol {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray-500);
  }

  .amount-input .form-control {
    padding-left: 2rem;
  }

  .recurring-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .recurring-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .recurring-checkbox {
    width: 1.25rem;
    height: 1.25rem;
    border-radius: 4px;
    border: 2px solid var(--gray-300);
    cursor: pointer;
  }

  .recurring-checkbox:checked {
    background-color: var(--primary);
    border-color: var(--primary);
  }

  .recurring-frequency {
    display: none;
  }

  .is-recurring .recurring-frequency {
    display: block;
  }

  .form-actions {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid var(--gray-200);
    display: flex;
    gap: 1rem;
  }

  /* Dark mode styles */
  body.dark-mode .form-actions {
    border-color: var(--dark-border);
  }

  body.dark-mode .currency-symbol {
    color: var(--gray-400);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const recurringCheckbox = document.querySelector(".recurring-checkbox");
    const recurringContainer = document.querySelector(".recurring-container");
    const frequencySelect = document.querySelector("#recurrence_frequency");

    function toggleRecurringFrequency() {
      recurringContainer.classList.toggle(
        "is-recurring",
        recurringCheckbox.checked
      );
      if (!recurringCheckbox.checked) {
        frequencySelect.value = "";
      }
    }

    recurringCheckbox.addEventListener("change", toggleRecurringFrequency);
    toggleRecurringFrequency();
  });
</script>
{% endblock %}
